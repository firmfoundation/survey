<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Survey management system - version 2.1.0</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <style>
        h1 {
            color: blue;
            font-family: verdana;
            font-size: 300%;
        }
        body {
            background : #95d5b2;
            margin: 0;
            padding: 0;
        }
        .cs-1 {
            background: #4ea8de;
            padding: 30px;
            margin: 20px;
            border-style: solid;
            border-width: 1px;
            border-color: #4ea8de;
            border-radius: 5px;
            max-width: 28rem;
        }
        .cs-2 {
            background: #e9ecef;
            padding: 30px;
            margin: 20px;
            border-style: solid;
            border-width: 1px;
            border-color: #ffffff;
            border-radius: 5px;
            max-width: 28rem;
        }
        .speech-bubble {
            position: relative;
            background: #ffffff;
            border-radius: .4em;
        }
        .speech-bubble:after {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 0;
            height: 0;
            border: 20px solid transparent;
            border-right-color: #ffffff;
            border-left: 0;
            border-bottom: 0;
            margin-top: -10px;
            margin-left: -20px;
        }
        
    </style>
</head>
    <body>
        <nav class="navbar bg-body-tertiary">
            <div class="container">
                <img src="static/img/bashanka.png" alt="QR code generator" width="30" class="rounded">
                Survey management system - v1.0.0
            </div>
        </nav>

        <div class="container mt-2">
            <div class="row justify-content-md-center mt-5">
                <div class="col col-lg-2">
                    <img src="static/img/bashanka.png" id="bashanka" class="rounded" width="150">
                </div>  
                <div class="col-md-auto">
                    <div class="card text-bg-warning mb-3" style="max-width: 32rem;">
                        <div class="card-body">
                            <ul class="list-group ">
                                <h5 class="card-title"> Hey ! Beautify your QR to color </h5>
                                <li class="list-group-item">Visually descriptive QR codes.</li>
                                <li class="list-group-item">Just one look capture your customers. </li>
                                <li class="list-group-item">When customers see your QR Image, much eager to scan it.</li>
                            </ul>
                        </div>
                    </div>
                </div>  
            </div>
        </div>

        <div class="container-sm ">
            <div class="row  was-validated justify-content-center">
                <div class="col cs-1 ">
                    <!-- left col   -->
                    <div class="form-floating mb-1">
                        <input type="text" class="form-control" id="txt-qr-size" value="3" size="10" required>
                        <label for="txt-qr-size" class="form-label">Size</label>
                        <div class="invalid-feedback">Size need to be between 1 to 21. </div>
                    </div>
                    <div class="form-floating mb-1">
                        <input type="text" class="form-control" id="txt-qr-link" placeholder="QR Link" value="https://www.nike.com/za/men" required>
                        <label for="txt-qr-link" class="form-label">QR text, link</label>
                        <div class="invalid-feedback">This field is the link/text pointed to when QR scanned. (min 1 and max 120 character)</div>
                    </div>
                    <div class="form-floating mb-1">
                        <input type="text" class="form-control" id="txt-qrfg-color" placeholder="QR Forground Color" value="#000000" required>
                        <label for="txt-qrfg-color" class="form-label">Qr Foreground Color</label>
                        <div class="invalid-feedback">Hex color example #000000 </div>
                    </div>      
                    <div class="form-floating mb-1">
                        <input type="text" class="form-control" id="txt-qrbg-color" placeholder="QR Background Color" value="#ffffff" required>
                        <label for="txt-qrbg-color" class="form-label">Qr Background Color</label>
                        <div class="invalid-feedback">Hex color example #ffffff </div>
                    </div>                      
                    <div class="form-floating mb-1">
                        <textarea class="form-control" id="txt-img-base64" style="height: 100px" required></textarea>
                        <label for="txt-img-base64" class="form-label">Image base64 encoded</label>
                        <div class="invalid-feedback">Put here base64 encoded Image for QR art.</div>
                    </div>
                    <div class="mt-3">
                        <button type="button" class="btn btn-warning btn-lg" id="btn-gen">Generate QR</button>
                    </div>
                </div>
                <div class="col cs-2">
                    <!-- right col   -->
                    <div class="text-center">
                       <img src="static/img/qr_v2.png" id="QrPreview" class="rounded">
                    </div>
                    <div class="text-center" id="custome-alert"></div>
                    <div class="mb-3d mt-3 text-center">
                        <button type="button" class="btn btn-dark btn-lg" id="btn-download">Download QR</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container-sm ">
            <div class="row text-center text-dark">
              <h5>Generated QR are üíØÔ∏è% scannable ! </h5>
            </div>
        </div>

        <!-- Footer -->
        <footer class="fixed-bottom">
            <!-- Copyright -->
            <div class="text-center pt-2" style="background-color: rgba(0, 0, 0, 0.05); height: 40px;">
                QR with image API Service - version 2.1.0  29.01.23
                <img src="static/img/bashanka.png" alt="QR code generator" width="20" class="rounded">
            </div>
            <!-- Copyright -->
        </footer>
        <!-- Footer -->

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
        <script>
            $(function () {
               
                $('#btn-gen').click(function () {
                    processing(true)
                    $('#btn-gen').hide()
                    $('#btn-download').hide()
                    $('#QrPreview').hide()
                    var payload = {
                        qrsize: Number($("#txt-qr-size").val()),
                        qrlink: $("#txt-qr-link").val(),
                        qrfgcolor: $("#txt-qrfg-color").val(),
                        qrbgcolor: $("#txt-qrbg-color").val(),
                        qrimage: $("#txt-img-base64").val()
                    };

                    $.ajax({
                        url: '/v2/base64',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(payload),
                        success: function (response) {
                            processing(false)
                            $('#btn-download').show()
                            $('#btn-gen').show()
                            $('#QrPreview').show()
                            $('#QrPreview').attr('src', `${response}`);
                            $( "#custome" ).remove();
                        },
                        error: function (response) {
                            processing(false)
                            addAlert(response.responseText);
                            $('#QrPreview').show()
                            $('#QrPreview').attr('src', "static/img/cartoon-frightened.png");
                            $('#btn-download').hide()
                            $('#btn-gen').show()
                        }
                    })
                });

                $('#btn-download').click(function () {
                    var link = document.createElement('a');
                    link.href = $('#QrPreview').attr('src'); 
                    link.download = 'QR.jpg';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                })

                {{/* $( "#txt-img-base64" ).ready(function() {
                    $('#txt-img-base64').append(defaultBase64);
                }); */}}

            })

            function addAlert(message) {
                $( "#custome" ).remove();
                $('#custome-alert').append(
                    '<div class="alert alert-danger" id="custome" role="alert">' + message + '</div>');
            } 

            function processing(flag) {
              if (flag == true) {
                $( "#processing" ).remove();
                $('#custome-alert').append(
                    `<div class="spinner-grow text-primary text-center" id="processing" role="status"><span class="visually-hidden">Loading...</span></div>`)
              } else {
                 $( "#processing" ).remove();
              }
            }           
            
        </script>
    </body>
</html>